<section class="checklist">
    <!-- <div class="row">
        <div class="col-12">
            <div class="col-md-3 pull-right">

                <div class="btn-group dropdown mr-2 mb-1 pull-right btn-sm" [ngClass]="{'show' : dropdownEvnt}" (mouseover)="dropdownEvnt=true" (mouseout)="dropdownEvnt=false">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ft-settings mr-2"></i>Excels &nbsp;</button>
                    <i class="ft-settings pull-right"></i>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="javascript:;"><i class="ft-bar-chart-2 mr-2"></i>Steps</a>
                        <a class="dropdown-item" href="javascript:;"><i class="ft-bell mr-2"></i>Check List</a>
                        <a class="dropdown-item" href="javascript:;"><i class="ft-clock mr-2"></i>Sample Excel</a>
                    </div>
                </div>
            </div>

        </div>
    </div> -->
    <div class="row">
        <div class="col-12">
            <ngx-spinner type="ball-scale-multiple"></ngx-spinner>
            <div class="card">
                <div class="card-content custmTbl">
                    <div class="card-body">
                        <!-- <div class="btn-group dropdown mr-2 mb-1 pull-right btn-sm" [ngClass]="{'show' : dropdownEvnt}" (mouseover)="dropdownEvnt=true" (mouseout)="dropdownEvnt=false">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ft-settings mr-2"></i>Excels &nbsp;</button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="javascript:;"><i class="ft-bar-chart-2 mr-2"></i>Steps</a>
                                <a class="dropdown-item" href="javascript:;"><i class="ft-bell mr-2"></i>Check List</a>
                                <a class="dropdown-item" href="javascript:;"><i class="ft-clock mr-2"></i>Sample Excel</a>
                            </div>
                        </div> -->
                        <form class="form" [formGroup]="waSearchFm" (ngSubmit)="onSubmit()">
                            <div class="row contentbody">

                                <div class="col-md-2 col-12">
                                    <h6 class="content-sub-header mb-1">WorkStream<span class="mandatory" style="color: red;">*</span></h6>
                                    <fieldset class="form-group">
                                        <select class="form-control" id="wsname" name="wsname" formControlName="wsname"
                                            (change)="getServiceslist()">
                                            <option value="">Select</option>
                                            <option *ngFor="let w of workstreamData" value="{{w.wid}}">{{w.w_name}}
                                            </option>
                                        </select>
                                        <div *ngIf="submitted && f['wsname'].errors" class="customValidation">
                                            <div *ngIf="f['wsname'].errors['required']">WorkStream Required</div>
                                        </div>
                                    </fieldset>
                                </div>
                                <div class="col-md-2 col-12">
                                    <h6 class="content-sub-header mb-1">Region</h6>
                                    <fieldset class="form-group">
                                        <select class="form-control" id="region" name="region" formControlName="region">
                                            <option value="">Select</option>
                                            <option *ngFor="let x of walotRegions" [ngValue]="x.rid">{{x.region_name}}
                                            </option>
                                        </select>
                                        <div *ngIf="submitted && f['region'].errors" class="customValidation">
                                            <div *ngIf="f['region'].errors['required']">Region Required</div>
                                        </div>
                                    </fieldset>
                                </div>
                                <div class="col-md-2 col-12">
                                    <h6 class="text-capitalize content-sub-header mb-1">Service<span class="mandatory" style="color: red;">*</span></h6>
                                    <fieldset class="form-group">
                                        <select class="form-control" id="service" name="service"
                                            formControlName="service" (change)="getBatches()">
                                            <option value="">Select Service</option>
                                            <option *ngFor="let x of walotServices" [ngValue]="x.sid">{{x.service_name}}
                                            </option>
                                        </select>
                                        <div *ngIf="submitted && f['service'].errors" class="customValidation">
                                            <div *ngIf="f['service'].errors['required']">Service Required</div>
                                        </div>
                                    </fieldset>
                                </div>
                                <div class="col-md-2 col-12">
                                    <h6 class="text-capitalize content-sub-header mb-1">Sub Service<span class="mandatory" style="color: red;">*</span></h6>
                                    <fieldset class="form-group">
                                        <select class="form-control" id="state" name="state" formControlName="state">
                                            <option value="">Select Sub Service</option>
                                            <option *ngFor="let w of walotBatches" [ngValue]="w.bid">{{w.batch_name}}
                                            </option>
                                        </select>
                                        <div *ngIf="submitted && f['state'].errors" class="customValidation">
                                            <div *ngIf="f['state'].errors['required']">State Required</div>
                                        </div>
                                    </fieldset>
                                </div>
                                <div class="col-md-2 col-12">
                                    <h6>&nbsp;&nbsp;</h6>
                                   <!--  <select onChange="window.location.href=this.value" class="form-control"
                                        formControlName="excel" id="excel" name="excel">
                                        <option value="/assets/excelfiles/MISSteps.xls">Excel for Steps</option>
                                        <option value="">Excel for Checklist</option>
                                        <option value="/assets/excelfiles/Checklist.xls">Checklist Sample Excel</option>
                                    </select> -->
                                    <div class="btn-group dropdown mr-2 mb-1 btn-sm" [ngClass]="{'show' : dropdownEvnt}" (mouseover)="dropdownEvnt=true" (mouseout)="dropdownEvnt=false">
                                        <button type="button" class="btn btn-light dropdown-toggle custmbtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <!-- <i class="ft-settings mr-2"></i> -->
                                            <img [src]="checkimg"/>&nbsp;
                                            Sample Excels &nbsp;</button>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" [href]="misSteps" target="_blank"><i class="ft-target mr-2"></i>Steps</a>
                                            <!-- <a class="dropdown-item" href="javascript:;"><i class="ft-check-square mr-2"></i>Check List</a> -->
                                            <a class="dropdown-item" [href]="smpCheck"><i class="ft-clock mr-2"></i>Sample Excel</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-12">
                                    <h6>&nbsp;&nbsp;</h6>
                                    <button type="submit" class="btn btn-sm btn-primary" [disabled]="waSearchFm.invalid" (click)="toggleShow()">Search</button>
                                </div>
                                <hr class="w-100"  *ngIf="isShown">
                            </div>
                            <div class="row contentbody">
                                <div class="table-responsive" *ngIf="chkdata.length > 0"  style="font-size: 11px !important;font-weight: 600;">
                                    <table class="table m-0 custmTbl">
                                        <thead class="thead-dark">
                                            <tr>
                                                <th>Work Stream</th>
                                                <th>Service</th>
                                                <th>Sub Service</th>
                                                <th>Step Name</th>
                                                <th>Step No</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let C of chkdata">
                                                <td>{{C.workstream}}</td>
                                                <td>{{C.service}}</td>
                                                <td>{{C.sub_service}}</td>
                                                <td>{{C.step_name}}</td>
                                                <td>{{C.sequence}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                            <div *ngIf="submitSearch && chkdata.length == 0" class="nodatamsg">
                                No Data Available.!
                            </div>
                            <!-- <br>
                            <table class="w-150  table table-bordered">
                                <tr>
                                    <td>
                                        <label><b>Prepared By (Process Engineer) :</b></label>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" id="process">
                                    </td>
                                    <td>
                                        <label><b>Approved By (Workstream Manager) :</b></label>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" id="approved">
                                    </td>
                                </tr>
                            </table> -->
                        </form>
                        <div class="row megaBtn">
                            <hr class="w-100" >
                             <!-- block button -->
                             <div class="col-12 col-md-4 mb-2 mb-md-0">
                                <button type="button" [ngClass]="btnStatus == 'grid' ? 'gradient-mint': 'btn-outline-secondary'" class="btn  btn-block" (click)="chkBtn('grid');">Check List Grid</button>
                              </div>
                            <!-- block button -->
                            <div class="col-12 col-md-4 mb-2 mb-md-0">
                              <button type="button" [ngClass]="btnStatus == 'version' ? 'gradient-mint': 'btn-outline-secondary'" class="btn  btn-block" (click)="chkBtn('version');">Add New Version of
                                Checklist</button>
                            </div>
                            <!-- block outline button -->
                            <div class="col-12 col-md-4">
                              <button type="button" [ngClass]="btnStatus == 'status' ? 'gradient-mint': 'btn-outline-secondary'" class="btn  btn-block" (click)="chkBtn('status')">Check List Approvals
                                Status ( <label class="chkcount">{{(approvlsCheckList.length > 0 ? approvlsCheckList.length : (approvlsCheckListGeneral.length > 0 ? approvlsCheckListGeneral.length : 0))}} </label> )</button>
                            </div>
                            <hr class="w-100">
                          </div>
                        <!-- <div class="row">
                            <div class="col-sm-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault"
                                        id="flexRadioDefault1" (click)="toggleUplaodShow()">
                                    <label class="form-check-label" for="flexRadioDefault1"><b>Add New Version of
                                            Checklist</b></label>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault"
                                        id="flexRadioDefault1">
                                    <label class="form-check-label" for="flexRadioDefault1"><b>Checklist
                                            Status</b></label>
                                </div>
                            </div>
                        </div> -->
                        <div class="col-md-4 col-12" *ngIf="btnStatus == 'version'">
                            <fieldset class="form-group">
                                <label for="inputGroupFile01"> &nbsp;</label>
                                <div class="custom-file">
                                    <input type="file" #csvReader name="Upload CSV" multiple id="jsonFile"
                                        accept=".xlsx" id="txtFileUpload" (change)="onFileChangechk($event)"
                                        class="custom-file-input">
                                    <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
                                </div>
                            </fieldset>
                        </div>
                        <div class="col-md-12 col-12" *ngIf="btnStatus == 'status' && approvlsCheckList.length == 0 && approvlsCheckListGeneral == 0" style="text-align: center;margin:20px;">
                           <h5>There is no any pending Approvals..!</h5>
                        </div>

                        <div class="table-responsive" *ngIf="btnStatus == 'grid' && revdata.length > 0"  style="font-size: 11px !important;font-weight: 600;">
                            <table class="table m-0 custmTbl">
                                <thead class="thead-dark">
                                    <tr>
                                        <th colspan="7" class="thtextalign">Present Version of Checklist used in MIS</th>
                                    </tr>
                                </thead>
                                <thead class="thead-light">
                                    <tr>
                                        <th colspan="3" class="thtextalign" style="text-align: left !important;">UR-004-CL</th>
                                        <th colspan="3" class="thtextalign" style="text-align: right !important;">Check List</th>
                                        <th colspan="3" class="thtextalign" style="text-align: right !important;">Verson No: {{revdata[0].version}}.0,  Date : {{revdata[0].version_date | date}}</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    <div class="table-responsive" *ngIf="btnStatus == 'grid' && revdata.length > 0"  style="font-size: 11px !important;font-weight: 600;">
                    <table class="table m-0 custmTbl">
                        <thead class="thead-dark">
                            <tr>
                                <th>Service</th>
                                <th>Sub Service</th>
                                <th>Rev Number</th>
                                <th>Rev Date</th>
                                <th>Order of Task</th>
                                <th>Step Name</th>
                                <th>Description</th>
                                <th>Step Order</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let R of revdata">
                                <td>{{R.service}}</td>
                                <td>{{R.sub_service}}</td>
                                <td>{{R.version}}</td>
                                <td>{{R.version_date | date}}</td>
                                <td>{{R.order_task}}</td>
                                <td>{{R.step_name}}</td>
                                <td>{{R.description}}</td>
                                <td>{{R.step_order}}</td>
                                <td>{{R.tasktype}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div *ngIf="submitSearch && btnStatus == 'grid' && revdata.length == 0" class="nodatamsg">
                    No Data Available.!
                </div>

                <div class="table-responsive" style="font-size: 11px !important;font-weight: 600;" *ngIf="exlsJson.length > 0 && btnStatus == 'version'">
                    <div class="d-flex mt-2 mb-2 justify-content-between">
                      <div class="col-md-4">Total Count:
                        <span class="badge badge-warning">{{(exlsJson.length > 0 ? exlsJson.length : 0)}}</span>
                       </div>

                        <!-- <div>Total Count : <label class="datacount">{{exlsJson.length}}</label></div> -->
                        <div>
                            <button type="submit" class="btn btn-sm btn-primary float-right"  (click)="saveBulkData()">Dump to Database</button>
                            <!-- <input type="button" class="btnsave ml-3" value="Dump to Database"
                                style="width: auto;" (click)="saveBulkData()">-->

                            </div>
                    </div>
                    <table class="table m-0 custmTbl">
                        <thead class="thead-dark">
                            <tr>
                                <!-- <th><input type="checkbox" name="isMasterSel" [(ngModel)]="isMasterSel" (change)="checkUncheckAll()"/></th> -->
                                <th style="width:100px">EmpNum</th>
                                <th>RevNum</th>
                                <th style="width : 200px">RevDate</th>
                                <th>Workstream</th>
                                <th>Service</th>
                                <th>Sub Service</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th >StepNum</th>
                                <th>StepName</th>
                                <th>OrderofTask</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let x of exlsJson">
                                <!-- <th scope="row"><input type="checkbox" name="checkasingle" (change)="isAllSelected()"/></th> -->
                                <td style="width:200px">{{x.EmpNum}}</td>
                                <td>{{x['RevNum']}}</td>
                                <td style="padding-left: 0px !important;padding-right: 0px !important;">{{x['RevDate'] | date : 'YYYY-M-d'}}</td>
                                <td>{{x['Workstream']}}</td>
                                <td>{{x['Service']}}</td>
                                <td>{{x['Sub Service']}}</td>
                                <td>{{x['Description']}}</td>
                                <td>{{x['Status']}}</td>
                                <td>{{x['StepNum']}}</td>
                                <td>{{x['StepName']}}</td>
                                <td>{{x['OrderofTask']}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>


                <div class="table-responsive" style="font-size: 11px !important;font-weight: 600;" *ngIf="approvlsCheckList.length > 0 && btnStatus == 'status'">
                    <div class="d-flex mt-2 mb-2 justify-content-between">
                        <!-- <div>Total Count : <label class="datacount">{{approvlsCheckList.length}}</label></div> -->
                        <div class="col-md-4">Total Count:
                          <span class="badge badge-warning">{{(approvlsCheckList.length > 0 ? approvlsCheckList.length : 0)}}</span>
                         </div>
                    </div>
                    <table class="table m-0 custmTbl">
                        <thead class="thead-dark">
                            <tr>
                                <!-- <th><input type="checkbox" name="isMasterSel" [(ngModel)]="isMasterSel" (change)="checkUncheckAll()"/></th> -->

                                <th>WorkStream</th>
                                <th>Service</th>
                                <th>Sub Service</th>
                                <th>Previous Version</th>
                                <th>Present Version</th>
                                <th>Approval Person</th>
                                <th>Approval Date</th>
                                <th colspan="2" style="text-align: center;">Approve Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let x of approvlsCheckList">
                                <td>{{x['w_name']}}</td>
                                <td>{{x['service_name']}}</td>
                                <td>{{x['batch_name']}}</td>
                                <td>{{x['previous_version']}}</td>
                                <td>{{x['present_version']}}</td>
                                <td>{{x['approve_name']}}</td>
                                <td>{{(x['approved_date'] == '1900-01-01T00:00:00' ? '': (x['approved_date'] | date))}}</td>
                                <!-- <td>{{x['approved_status']}}</td> -->
                                <td *ngIf="getRole(userRole) == 'Manager' && userId == x.approve_id"><button type="button" class="btn btn-sm btn-success btncustom" (click)="approveThis(x,'Y')">Approve</button></td>
                                <td *ngIf="getRole(userRole) == 'Manager' && userId == x.approve_id"><button type="button" class="btn btn-sm btn-danger btncustom" (click)="approveThis(x,'R')">Reject</button></td>
                                <td *ngIf="getRole(userRole) == 'Manager' && userId != x.approve_id && x['approved_status'] == 'N'"><button type="button" class="btn btn-sm btn-warning btncustom">{{x['approved_status'] == 'N' ? 'Not Yet Approved' : ''}}</button></td>
                                <td *ngIf="getRole(userRole) == 'Manager' && userId != x.approve_id && x['approved_status'] == 'R'"><button type="button" class="btn btn-sm btn-danger btncustom">{{x['approved_status'] == 'R' ? 'Rejected' : ''}}</button></td>
                                <td *ngIf="getRole(userRole) != 'Manager'">
                                   <span *ngIf="x['approved_status'] == 'N'" style="color:orange;font-weight: bold;">{{x['approved_status'] == 'N' ? 'Not Yet Approved' : ''}}</span>
                                    <span *ngIf="x['approved_status'] == 'R'" style="color:red;font-weight: bold;">{{x['approved_status'] == 'R' ? 'Rejected' : ''}}</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>


                <div class="table-responsive" style="font-size: 11px !important;font-weight: 600;" *ngIf="approvlsCheckListGeneral.length > 0 && btnStatus == 'status'">
                  <div class="d-flex mt-2 mb-2 justify-content-between">
                      <div class="col-md-4">Total Count:
                        <span class="badge badge-warning">{{(approvlsCheckList.length > 0 ? approvlsCheckList.length : 0)}}</span>
                       </div>
                  </div>
                  <table class="table m-0 custmTbl">
                      <thead class="thead-dark">
                          <tr>
                              <th>WorkStream</th>
                              <th>Service</th>
                              <th>Sub Service</th>
                              <th>Updated on</th>
                              <th>Approval Person</th>
                              <th>Approval Date</th>
                              <th colspan="2">Approve Status</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr *ngFor="let x of approvlsCheckListGeneral">
                              <td>{{x['w_name']}}</td>
                              <td>{{x['service_name']}}</td>
                              <td>{{x['batch_name']}}</td>
                              <td>{{x['updateddate'] | date : 'YYYY-MM-dd'}}</td>
                              <td>{{x['emp_id']}}</td>
                              <td>{{(x['approved_date'] == '1900-01-01T00:00:00' ? '': (x['approved_date'] | date))}}</td>

                              <td>
                                 <span *ngIf="x['approve_status_2'] == '' || x['approve_status_2'] == 'Pending' " style="color:orange;font-weight: bold;">{{x['approve_status_2'] == '' ? 'Pending' : (x['approve_status_2'] == 'Pending' ? 'Pending' : '')}}</span>
                                 <span *ngIf="x['approve_status_2'] == 'Approved'" style="color:rgb(15, 146, 33);font-weight: bold;">{{x['approve_status_2'] == 'Approved' ? 'Approved' : ''}}</span>
                                  <span *ngIf="x['approve_status_2'] == 'Rejected'" style="color:red;font-weight: bold;">{{x['approve_status_2'] == 'Rejected' ? 'Rejected' : ''}}</span>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
